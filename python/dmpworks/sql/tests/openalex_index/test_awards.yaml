test_openalex_index_awards:
  model: openalex_index.awards
  inputs:
    openalex_index.works_metadata:
      rows:
        - id: "W0000000001"
          doi: "10.9999/test.0001"
        - id: "W0000000002"
          doi: "10.9999/test.0002"
        - id: "W0000000003"
          doi: "10.9999/test.0003"
    crossref.crossref_metadata:
      rows:
        - doi: "10.9999/test.0001"
          funders:
            - award: "1"
        - doi: "10.9999/test.0002"
          funders:
            - award: "2"
        - doi: "10.9999/test.0002"
          funders:
            - award: null
    openalex.openalex_works:
      rows:
        - id: "W0000000001"
          awards:
            - funder_award_id: "3"
        - id: "W0000000001"  # nulls should be filtered out
          awards:
            - funder_award_id: null
        - id: "W0000000001"  # duplicates should be filtered out
          awards:
            - funder_award_id: "1"
        - id: "W0000000002"
          awards:
            - funder_award_id: "4"
        - id: "W0000000002" # duplicates should be filtered out
          awards:
            - funder_award_id: "2"
  outputs:
    query:
      rows:
        - doi: "10.9999/test.0001"
          awards:
            - award_id: "1"
            - award_id: "3"
        - doi: "10.9999/test.0002"
          awards:
            - award_id: "2"
            - award_id: "4"

